namespace Gost89;

public static class GostLib
{
  private static readonly byte[][] SubstitutionBox =
  {
    new byte[] { 0x0, 0x1, 0x2, 0x3, 0x4, 0x5, 0x6, 0x7, 0x8, 0x9, 0xA, 0xB, 0xC, 0xD, 0xE, 0xF },
    new byte[] { 0x0, 0x1, 0x2, 0x3, 0x4, 0x5, 0x6, 0x7, 0x8, 0x9, 0xA, 0xB, 0xC, 0xD, 0xE, 0xF },
    new byte[] { 0x0, 0x1, 0x2, 0x3, 0x4, 0x5, 0x6, 0x7, 0x8, 0x9, 0xA, 0xB, 0xC, 0xD, 0xE, 0xF },
    new byte[] { 0x0, 0x1, 0x2, 0x3, 0x4, 0x5, 0x6, 0x7, 0x8, 0x9, 0xA, 0xB, 0xC, 0xD, 0xE, 0xF },
    new byte[] { 0x0, 0x1, 0x2, 0x3, 0x4, 0x5, 0x6, 0x7, 0x8, 0x9, 0xA, 0xB, 0xC, 0xD, 0xE, 0xF },
    new byte[] { 0x0, 0x1, 0x2, 0x3, 0x4, 0x5, 0x6, 0x7, 0x8, 0x9, 0xA, 0xB, 0xC, 0xD, 0xE, 0xF },
    new byte[] { 0x0, 0x1, 0x2, 0x3, 0x4, 0x5, 0x6, 0x7, 0x8, 0x9, 0xA, 0xB, 0xC, 0xD, 0xE, 0xF },
    new byte[] { 0x0, 0x1, 0x2, 0x3, 0x4, 0x5, 0x6, 0x7, 0x8, 0x9, 0xA, 0xB, 0xC, 0xD, 0xE, 0xF }
  };

  public static uint[] GenerateKeys(byte[] key)
  {
    if (key.Length != 32)
    {
      throw new Exception("Wrong key.");
    }

    var subkeys = new uint[8];

    for (var i = 0; i < 8; i++)
    {
      subkeys[i] = BitConverter.ToUInt32(key, 4 * i);
    }

    return subkeys;
  }

  public static uint Substitution(uint value)
  {
    uint output = 0;

    for (var i = 0; i < 8; i++)
    {
      var temp = (byte)((value >> (4 * i)) & 0x0f);
      temp = SubstitutionBox[i][temp];
      output |= (uint)temp << (4 * i);
    }

    return output;
  }
}